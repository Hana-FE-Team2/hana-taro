<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/style.css" />
    <title>Document</title>
  </head>
  <style>
    .card {
      position: absolute;
      transition: left 2s ease, transform 2s ease;
      /* transition: transform 2s ease; */
      width: 200px;
      height: 300px;
      /* box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); */
      box-shadow: -10px 10px 10px rgba(0, 0, 0, 0.2); /* 오른쪽 위에 밝은 그림자와 왼쪽 아래 그림자 */
      left: 0px;
      right: 0px;
      margin-left: auto;
      margin-right: auto;
      border-radius: 15px;
    }
    .fixed {
      position: fixed;
      width: 100%;
    }
    .scroll {
      width: 100%;
      /* height: 10000px; */
      position: absolute;
    }
    body::-webkit-scrollbar {
      display: none;
    }
    .current-card {
      cursor: pointer;
      transition: all 2s ease;
    }
    .current-card:hover {
      /* border: 1.5px solid gold; */
      transform: scale(1.1);
    }
    .selected-card {
      position: absolute;
      transition: all 2s ease;
      width: 200px;
      height: 300px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      left: 0px;
      right: 0px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: -10px 10px 10px rgba(0, 0, 0, 0.2);
      border-radius: 15px;
    }
    .scroll-card {
      transform: translateY(1500px);
    }
    /* 해상도 768px ~ 1023px */
    @media all and ((min-width: 768px) and (max-width: 1023px)),
      ((min-height: 541px) and (max-height: 640px)) {
      .card,
      .selected-card {
        width: 150px;
        height: 225px;
      }
    }
    /* 해상도 ~ 767px */
    @media all and (min-width: 576px) and (max-width: 767px),
      ((min-height: 420px) and (max-height: 540px)) {
      .card,
      .selected-card {
        width: 100px;
        height: 150px;
      }
    }
    /* 해상도 ~ 767px */
    @media all and (max-width: 575px), (max-height: 419px) {
      .card,
      .selected-card {
        width: 50px;
        height: 75px;
      }
    }
  </style>
  <body style="height: 100vh">
    <div class="scroll"></div>
    <button id="open-modal" style="display: none"></button>

    <button id="open-modal-multi" style="display: none"></button>
    <div class="container fixed">
      <div class="cards-wrapper">
        <img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="0"
        />
        <img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="1"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="2"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="3"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="4"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="5"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="6"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="7"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="8"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="9"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="10"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="11"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="12"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="13"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="14"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="15"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="16"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="17"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="18"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="19"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="20"
        /><img
          src="../../img/component/cardBack.jpg"
          alt=""
          class="card"
          id="21"
        />
      </div>
      <div id="modal" class="modal"></div>
    </div>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="./js/card.js"></script>

    <script>
      /* 카드가 쌓여보이도록 조정하는 함수 */
      // const DISTANCE = [-275, -225, -175, -125];
      // const INTERVAL = [30, 25, 20, 15];
      // let spreadCard = (distance, interval) => {
      //   const SPEED = 25;

      //   for (let n = 0; n < CARD_COUNT; n++) {
      //     setTimeout(() => {
      //       for (let i = n; i < CARD_COUNT; i++) {
      //         $(".card")
      //           .eq(i)
      //           .css("left", `${distance + n * interval}px`);
      //       }
      //     }, SPEED * (n + 1));
      //   }
      // };
    </script>

    <script>
      // 카드 선택 애니메이션 기본 세팅

      const SCROLL_SCOPE = 400;
      let lastScroll;
      let index;
      $(document).ready(() => {
        index = CARD_COUNT - 1;
        $(`#${index}`).addClass("current-card");
        $(window).scrollTop(0);
        $(".scroll").css("height", `${SCROLL_SCOPE * (CARD_COUNT + 2)}`); // 2을 더해 마지막 카드도 스크롤 가능
        console.log("current index: " + index + " 스크롤 위치: 0");
      });

      // 스크롤 애니메이션 (스크롤 영역에 맞는 index로 동작)
      $(window).on("scroll", () => {
        let cardTranslate = parseInt($(".card").css("height").slice(0, -2)) * 5;
        let scroll = $(window).scrollTop();
        index = Math.floor(CARD_COUNT - scroll / SCROLL_SCOPE) - 1;

        console.log(
          "current index: " +
            index +
            " 스크롤 위치: " +
            Math.floor($(window).scrollTop())
        );

        if (scroll - lastScroll < 0) {
          // 인덱스 범위를 벗어난 경우 실행하지 않는다.

          if (index < 0) {
            return;
          }
          // console.log("스크롤 올릴 때");
          $(".card").eq(index).removeClass("scroll-card");
          $(".card").addClass;
          $(".card")
            .eq(index - 1)
            .removeClass("current-card");
          $(".card").eq(index).addClass("current-card");
        } else {
          // console.log("스크롤 내릴 때");
          $(".card")
            .eq(index + 1)
            .removeClass("current-card");
          $(".card")
            .eq(index + 1)
            .addClass("scroll-card");
          $(".card").eq(index).addClass("current-card");
        }

        if (cnt == 3) {
          console.log("모달 띄우기");
          $(`#${index}`).removeClass("current-card");
          setTimeout(() => {
            messages = ["다 뽑으셨다면 설명을 해드리죠....."];
            $("#open-modal").click();
          }, 2000);
        }
        lastScroll = scroll;
      });

      // 카드 선택 애니메이션 (e.target.id로 동작)
      let cnt = 0;
      const TRANSLATE = {
        x: "200%",
        y: ["-75%", "0%", "75%"],
      };

      $(document).on("click", ".current-card", (e) => {
        let id = e.target.id;
        // console.log(e.target.id);

        $(`#${id}`).removeClass("card current-card");
        $(`#${id}`).addClass(`selected-card`);
        $(`#${id - 1}`).addClass("current-card");
        $(window).scrollTop((CARD_COUNT - id - 1) * SCROLL_SCOPE + 100);

        $(`#${id}`).css({
          left: "0px",
          transform: `translate(${TRANSLATE.x}, ${TRANSLATE.y[cnt]}) scale(0.5)`,
        });

        cnt++;
      });
    </script>
    <script src="/js/app.js"></script>
    <script src="/js/modal.js"></script>
    <script type="text/javascript">
      var messages = [
        "카드를 스크롤해서\n원하는 카드 세장을 선택해주세요.....",
      ];

      // 다음 페이지 이동 버튼을 눌렀을 때, 다음 페이지로 이동 할 수 있도록 하는 이벤트
      // 본인의 상황에 맞춰서 다음 페이지로 넘어가야 할 경우, 결론적으로는 loadNextContent 함수에 이동하고자 하는 html 파일명을 인자로 넘겨주면 됨
      $(document).on("click", "#move-next-page", function (data) {
        $("#modal").fadeOut();
        loadNextContent("index4.html");
      });
    </script>
  </body>
</html>
